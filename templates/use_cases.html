{% include "header.html" %}

{% block content %}
    <h1>Use Case Selection</h1>
    <h2>Choose Dataset and Model</h2>
    <form action="/process_selection" method="POST">
        <label for="dataset">Select a Dataset:</label>
        <select id="dataset" name="dataset">
            <option value="" selected disabled>Select a Dataset</option> <!-- Default option -->
            {% for dataset in data %}
            <option value="{{ dataset['name'] }}">{{ dataset['name'] }}</option>
            {% endfor %}
        </select>
        <br>

        <!-- Display the description content -->
        <p id="description"></p>

        <label for="model">Select a Model:</label>
        <select id="model" name="model">
            <option value="" disabled selected>Select a Model</option>
        </select>

        <br>
        <br>
        <h2>Drift Experiment Configuration</h2>
        <label for="window_size">Select Window Size:</label>
        <select id="window_size" name="window_size" disabled>
            <option value="" selected disabled>Select a Window Size</option>
        </select>
        <br>
        <br>
        <label for="drift_pattern">Select Drift Pattern:</label>
        <select id="drift_pattern" name="drift_pattern" disabled>
            <option value="" selected disabled>Select a Drift Pattern</option> <!-- Default option -->
            <option value="no_drift">No Drift</option>
            <option value="sudden_drift">Sudden Drift</option>
            <option value="incremental_drift">Incremental Drift</option>
            <option value="periodic_drift">Periodic Drift</option>
        </select>
        <br>
        <br>
        <!-- Component for selecting the number of windows -->
        <div id="no-drift-options" style="display: none;">
            <label for="number_of_windows_no_drift">Number of windows:</label>
            <input type="range" id="number_of_windows_no_drift" name="number_of_windows_no_drift" min="10" max="1000" step="10" value="100">
            <output for="number_of_windows_no_drift">100</output>
        </div>

        <!-- Additional elements for Sudden Drift (Number of Windows, Drift Offset, and Drift Percentage) -->
        <div id="sudden-drift-options" style="display: none;">
            <label for="number_of_windows_sudden_drift">Number of Windows:</label>
            <input type="range" id="number_of_windows_sudden_drift" name="number_of_windows_sudden_drift" min="10" max="1000" step="10" value="100">
            <output for="number_of_windows_sudden_drift">100</output>
            <br>
            <label for="drift_offset_sudden_drift">Drift Starting Offset:</label>
            <input type="range" id="drift_offset_sudden_drift" name="drift_offset_sudden_drift" min="10" max="1000" step="10" value="50">
            <output for="drift_offset_sudden_drift">50</output>
            <br>
            <label for="drift_percentage_sudden_drift">Drift Percentage:</label>
            <input type="range" id="drift_percentage_sudden_drift" name="drift_percentage_sudden_drift" min="1" max="100" step="1" value="20">
            <output for="drift_percentage_sudden_drift">20</output>
        </div>

        <!-- ... Additional elements for Incremental Drift and Periodic Drift ... -->
                <!-- Additional elements for Sudden Drift (Number of Windows, Drift Offset, and Drift Percentage) -->
        <div id="incremental-drift-options" style="display: none;">
            <label for="number_of_windows_incremental_drift">Number of Windows:</label>
            <input type="range" id="number_of_windows_incremental_drift" name="number_of_windows_incremental_drift" min="10" max="1000" step="10" value="100">
            <output for="number_of_windows_incremental_drift">100</output>
            <br>
            <label for="drift_offset_incremental_drift">Drift Starting Offset:</label>
            <input type="range" id="drift_offset_incremental_drift" name="drift_offset_incremental_drift" min="10" max="1000" step="10" value="50">
            <output for="drift_offset_incremental_drift">50</output>
            <br>
            <label for="drift_percentage_incremental_drift">Drift Starting Percentage:</label>
            <input type="range" id="drift_percentage_incremental_drift" name="drift_percentage_incremental_drift" min="1" max="100" step="1" value="20">
            <output for="drift_percentage_incremental_drift">20</output>
            <br>
            <label for="drift_increasing_percentage_incremental_drift">Drift Increasing Percentage:</label>
            <input type="range" id="drift_increasing_percentage_incremental_drift" name="drift_increasing_percentage_incremental_drift" min="1" max="100" step="1" value="20">
            <output for="drift_increasing_percentage_incremental_drift">20</output>
        </div>

        <div id="periodic-drift-options" style="display: none;">
            <label for="number_of_windows_periodic_drift">Number of Windows:</label>
            <input type="range" id="number_of_windows_periodic_drift" name="number_of_windows_periodic_drift" min="10" max="1000" step="10" value="100">
            <output for="number_of_windows_periodic_drift">100</output>
            <br>
            <label for="drift_offset_periodic_drift">Drift Offset:</label>
            <input type="range" id="drift_offset_periodic_drift" name="drift_offset_periodic_drift" min="10" max="1000" step="10" value="50">
            <output for="drift_offset_periodic_drift">50</output>
            <br>
            <label for="drift_percentage_periodic_drift">Drift Percentage:</label>
            <input type="range" id="drift_percentage_periodic_drift" name="drift_percentage_periodic_drift" min="1" max="100" step="1" value="20">
            <output for="drift_percentage_periodic_drift">20</output>
        </div>

        <br>
        <br>
        <input type="submit" value="Submit" id="submit-button" disabled>
    </form>

    <script>
    var datasetDropdown = document.getElementById("dataset");
    var modelDropdown = document.getElementById("model");
    var descriptionElement = document.getElementById("description");
    var windowSizeDropdown = document.getElementById("window_size");
    var driftPatternDropdown = document.getElementById("drift_pattern");
    var submitButton = document.getElementById("submit-button");
    var noDriftOptions = document.getElementById("no-drift-options");
    var suddenDriftOptions = document.getElementById("sudden-drift-options");
    var incrementalDriftOptions = document.getElementById("incremental-drift-options");
    var periodicDriftOptions = document.getElementById("periodic-drift-options");
    var number_of_windows_no_drift = document.getElementById("number_of_windows_no_drift");
    var number_of_windows_sudden_drift = document.getElementById("number_of_windows_sudden_drift");
    var number_of_windows_incremental_drift = document.getElementById("number_of_windows_incremental_drift");
    var number_of_windows_periodic_drift = document.getElementById("number_of_windows_periodic_drift");
    var drift_offset_sudden_drift = document.getElementById("drift_offset_sudden_drift");
    var drift_percentage_sudden_drift = document.getElementById("drift_percentage_sudden_drift");

    // Convert the datasets variable from JSON format
    var datasets = JSON.parse('{{ data|tojson|safe }}');

    datasetDropdown.addEventListener("change", function() {
        // Clear existing options in the model and window size dropdowns
        modelDropdown.innerHTML = "<option value='' disabled selected>Select a Model</option>";
        windowSizeDropdown.innerHTML = "<option value='' disabled selected>Select a Window Size</option>";

        // Reset drift pattern selection and hide additional options
        driftPatternDropdown.selectedIndex = 0;
        driftPatternDropdown.setAttribute("disabled", "disabled");
        hideAdditionalOptions();

        // Get the selected dataset
        var selectedDataset = datasetDropdown.value;

        var selectedDatasetModels = datasets.find(function(dataset) {
            return dataset.name === selectedDataset;
        }).models;

        selectedDatasetModels.forEach(function(model) {
            var option = document.createElement("option");
            option.value = model.name;
            option.text = model.name;
            modelDropdown.appendChild(option);
        });

        loadDatasetDescription(selectedDataset);
    });

    modelDropdown.addEventListener("change", function() {
        var selectedModel = modelDropdown.value;
        if (selectedModel) {
            var selectedDataset = datasetDropdown.value;

            var selectedDatasetModels = datasets.find(function(dataset) {
                return dataset.name === selectedDataset;
            }).models;

            var selectedModelInfo = selectedDatasetModels.find(function(model) {
                return model.name === selectedModel;
            });

            if (selectedModelInfo && selectedModelInfo.window_sizes) {
                selectedModelInfo.window_sizes.forEach(function(windowSize) {
                    var option = document.createElement("option");
                    option.value = windowSize;
                    option.text = windowSize;
                    windowSizeDropdown.appendChild(option);
                });
                windowSizeDropdown.removeAttribute("disabled");
            }
        }

        // Enable the drift pattern dropdown when both dataset and model are selected
        enableDriftPatternDropdown();
    });

    function enableDriftPatternDropdown() {
        var selectedModel = modelDropdown.value;
        var selectedDataset = datasetDropdown.value;
        if (selectedModel && selectedDataset) {
            driftPatternDropdown.removeAttribute("disabled");
        }
    }

    windowSizeDropdown.addEventListener("change", function() {
        validateForm();
    });

    driftPatternDropdown.addEventListener("change", function() {
        var selectedDriftPattern = driftPatternDropdown.value;

        // Hide or show the additional options based on the selected drift pattern
        hideAdditionalOptions();

        if (selectedDriftPattern === "no_drift") {
            noDriftOptions.style.display = "block";
        } else if (selectedDriftPattern === "sudden_drift") {
            suddenDriftOptions.style.display = "block";
        } else if (selectedDriftPattern === "incremental_drift") {
            incrementalDriftOptions.style.display = "block";
        } else if (selectedDriftPattern === "periodic_drift") {
            periodicDriftOptions.style.display = "block";
        }

        validateForm();
    });

    number_of_windows_no_drift.addEventListener("input", function() {
        var outputElement = this.nextElementSibling; // Get the <output> element for this input
        outputElement.textContent = this.value; // Update the <output> element with the current value
        validateForm(); // Call your validation function (if needed)
    });


    number_of_windows_sudden_drift.addEventListener("input", function() {
        var outputElement = this.nextElementSibling; // Get the <output> element for this input
        outputElement.textContent = this.value; // Update the <output> element with the current value
        validateForm(); // Call your validation function (if needed)
    });

    number_of_windows_incremental_drift.addEventListener("input", function() {
        var outputElement = this.nextElementSibling; // Get the <output> element for this input
        outputElement.textContent = this.value; // Update the <output> element with the current value
        validateForm(); // Call your validation function (if needed)
    });

    number_of_windows_periodic_drift.addEventListener("input", function() {
        var outputElement = this.nextElementSibling; // Get the <output> element for this input
        outputElement.textContent = this.value; // Update the <output> element with the current value
        validateForm(); // Call your validation function (if needed)
    });

    drift_offset_sudden_drift.addEventListener("input", function() {
        var outputElement = this.nextElementSibling; // Get the <output> element for this input
        outputElement.textContent = this.value; // Update the <output> element with the current value
        validateForm(); // Call your validation function (if needed)
    });

    drift_percentage_sudden_drift.addEventListener("input", function() {
        var outputElement = this.nextElementSibling; // Get the <output> element for this input
        outputElement.textContent = this.value; // Update the <output> element with the current value
        validateForm(); // Call your validation function (if needed)
    });

    // Additional input validation and event listeners for other drift patterns (Incremental Drift, Periodic Drift) can be added similarly.

    function hideAdditionalOptions() {
        noDriftOptions.style.display = "none";
        suddenDriftOptions.style.display = "none";
        incrementalDriftOptions.style.display = "none";
        periodicDriftOptions.style.display = "none";
        // Hide other additional options here when implemented.
    }

    function loadDatasetDescription(datasetName) {
        var encodedDatasetName = encodeURIComponent(datasetName);

        var descriptionFile = `/static/use_cases/datasets/${encodedDatasetName}/description.txt`;
        var xhr = new XMLHttpRequest();
        xhr.open("GET", descriptionFile, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    var descriptionText = xhr.responseText;
                    descriptionElement.textContent = descriptionText;
                } else {
                    descriptionElement.textContent = "Description not available.";
                }
            };
            xhr.send();
        };
    }

    function validateForm() {
        var selectedModel = modelDropdown.value;
        var selectedDataset = datasetDropdown.value;
        var selectedDriftPattern = driftPatternDropdown.value;
        //var selectedWindowSize = windowSizeDropdown.value;

        if (selectedModel && selectedDataset && selectedDriftPattern) {
            valid = true
         //   if (selectedDriftPattern === "no_drift") {
          //      if (selectedWindowSize) {
                    // Additional validation for No Drift (if needed)
          //      }
          //  } else if (selectedDriftPattern === "sudden_drift") {
          //      if (selectedWindowSize) {
                    // Additional validation for Sudden Drift
           //     }
                // Additional validation for Number of Windows, Drift Offset, and Drift Percentage can be added here.
           // }
            // Additional validation for other drift patterns can be added similarly.
        }

        if (valid) {
            submitButton.removeAttribute("disabled");
        } else {
            submitButton.setAttribute("disabled", "disabled");
        }
    }
    </script>
{% endblock %}
{% include "footer.html" %}
